#
#data
#
# My Program uses 312 bytes
CLOCK	START	7EC8
TWELVE	WORD	12
HOURS	WORD	3600	# 60*60 seconds in an hour
STORE	WORD	0	# Store hours
MINS	WORD	60	# 60 seconds in a minute and Stores minutes
ASCII	WORD	48	# ASCII value for zero in decimal
ZERO	WORD	0
AMORPM	WORD	0	# 0 for AM, 1 for PM
ONE	WORD	1
TWO	WORD	2
DEVICE	WORD	64
IF	WORD	1	# If 24 hours is enabled this will be zero 
MSB	WORD	8388607	# 0111.. bit mask to make last bit of MSB zero
#
#code
#
# Load into A register TIMER which is at the last 3 bytes
	LDA	TIMER
	STA	SAVED	
	COMP	ZERO
	JLT	ADJUST	# Jump to ADJUST if 24 hour format
	J	CALC
ADJUST	AND	MSB	# change MSB to 0		
	STA	SAVED
	LDA	ZERO
	STA	IF
# CALCULATE HOURS	
CALC	LDA	SAVED
	DIV	HOURS
	STA	STORE
# CALCULATE MINS
	LDA	SAVED
	COMP	HOURS
	JLT	CALCM
LOOP1	SUB	HOURS
	COMP	HOURS
	JLT	CALCM
	J	LOOP1
CALCM	DIV	MINS
	STA	MINS
	LDA	IF
	COMP	ZERO
	JEQ	OUTPUT	# output hours in 24 format
# FIX HOURS FOR 12 Hour format HHMMT
	LDA	STORE
	COMP	TWELVE
	JGT	FIX
	JEQ	FIX
	COMP	ZERO
	JEQ	MIDNIT	# if 12AM
	J	OUTPUT
MIDNIT	LDA	TWELVE
	STA	STORE
	J	OUTPUT
FIX	LDA	ONE
	STA	AMORPM	# Put 1 into AMORPM to indicate PM
	LDA	STORE
	COMP	TWELVE
	JEQ	OUTPUT
	SUB	TWELVE
	STA	STORE	
OUTPUT	LDX	TWO
OUT	WORD	0
TEN	WORD	10
# WRITE HOURS TO DEVICE
	LDA	STORE
	DIV	TEN
	ADD	ASCII
	STA	OUT
	LDCH	OUT,X
	WD	DEVICE	# Write tens place in hours to DEVICE
	SUB	ASCII
	MUL	TEN
	STA	OUT
	LDA	STORE
	SUB	OUT
	ADD	ASCII
	STA	OUT
	LDCH	OUT,X
	WD	DEVICE	# Write ones place in hours to DEVICE
# WRITE MINS TO DEVICE
	LDA	MINS
	DIV	TEN
	ADD	ASCII
	STA	OUT
	LDCH	OUT,X
	WD	DEVICE	# Write tens place in MINS to DEVICE
	SUB	ASCII
	MUL	TEN
	STA	OUT
	LDA	MINS
	SUB	OUT
	ADD	ASCII
	STA	OUT
	LDCH	OUT,X
	WD	DEVICE	# Write ones place in MINS to DEVICE
	LDA	IF
	COMP	ZERO
	JEQ	ENDING	# Done with 24 hour format
	LDX	TWO
	LDA	AMORPM
	COMP	ZERO
	JEQ	AM
PM	WORD	80
	LDCH	PM,X
	WD	DEVICE
	J	ENDING
AM	WORD	65
	LDCH	AM,X
	WD	DEVICE
ENDING	LDL	ZERO
	RSUB		
SAVED	RESW	1
TIMER	RESW	1
	END	CLOCK
